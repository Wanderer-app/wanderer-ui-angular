<div class="p-3 bg-light" style="min-height:100%">
    <div class="d-block text-end">
        <button class="btn btn-sm btn-secondary m-1" (click)="close.emit()">
            <fa-icon [icon]="closeIcon"></fa-icon>
        </button>
    </div>
    
    <div style="word-wrap:break-word;" *ngFor="let element of (discussion$ | async)">
        
        <div *ngIf="element.type === post" class="rounded shadow mt-4 p-3 bg-white">
            <div class="row g-2">
                <div class="col-11 d-flex">
                    <img src="assets/img/avatar.jpg" alt="" style="width:auto;max-height:50px;" class="rounded-circle img-fluid">
                    <span class="ms-2">
                        <h5 class="mb-0">{{element.creator | fullname}}</h5>
                        <small class="text-secondary">{{element.createdAt}}</small>
                    </span>
                    <span class="ms-3 h-100 d-flex align-items-center">
                        <app-rating
                            [size]="ratingSize"
                            [contentId]="element.id"
                            [ratingValue]="element.ratingData ? element.ratingData.totalRating : 0"
                            [service]="postService"
                            [userVoteDirection]="element.userVoteDirection"
                        ></app-rating>
                    </span>
                </div>
                <div class="col-1 text-end">
                    <app-content-control-menu
                        [placement] = "controlMenuPlacement"
                        [contentType] = "post"
                        [backgroundColor] = "'white'"
                        [contentId] = "element.id"
                        [contentCreatorId] = "element.creator.id"
                        [contentIsActive] = "element.isActive"
                        [service] = "postService"
                    ></app-content-control-menu>
                </div>
            </div>
    
            <p class="mt-2">
                {{element.content}}
            </p>
    
            <div class="mt-3">
                <app-comments
                    [commentableContentId]="element.id"
                    [comments]="element.commentsPreview"
                    [totalCommentsNumber]="element.commentsAmount"
                    [commentableContentService]="postService"
                ></app-comments>
            </div>
        </div>

        <div *ngIf="element.type === poll" class="rounded shadow mt-4 p-3 bg-white">
            <div class="row g-2">
                <div class="col-11 d-flex">
                    <img src="assets/img/avatar.jpg" alt="" style="width:auto;max-height:50px;" class="rounded-circle img-fluid">
                    <span class="ms-2">
                        <h5 class="mb-0">{{element.creator | fullname}}</h5>
                        <small class="text-secondary">{{element.createdAt}}</small>
                    </span>
                </div>
                <div class="col-1 text-end">
                    <app-content-control-menu
                        [placement] = "controlMenuPlacement"
                        [contentType] = "poll"
                        [backgroundColor] = "'white'"
                        [contentId] = "element.id"
                        [contentCreatorId] = "element.creator.id"
                        [contentIsActive] = "element.isActive"
                        [service] = "pollService"
                    ></app-content-control-menu>
                </div>
            </div>
    
            <p class="mt-2">
                {{pollQuestion(element.content)}}
            </p>
    
            <div class="mt-3 p-5 container bg-light">
    
                <div *ngFor="let answerData of pollAnswersData(element.content)" class="d-flex">
                    <div (click)="selectPollAnswer(element.id, answerData.answerId)" class="border border-secondary rounded mb-3 position-relative poll-answer" style="transition: 300ms; height: 40px;cursor: pointer;width: 90%;">
                        <div class="bg-{{hasUsersVote(answerData.answererIds) ? 'primary' : 'secondary'}} rounded h-100" style="width: {{answerData.percentage}}%;"></div>
                        <span class="position-absolute start-0 top-0 h-100 w-100 d-flex align-items-center justify-content-center ">
                            {{ answerData.title }}
                        </span>
                    </div>
                    <div class="text-secondary ms-2 d-flex align-items-center" style="line-height: 1;height: 40px;">
                        {{ answerData.answererIds.length }} ხმა
                    </div>
                </div>
    
            </div>
    
            <div class="mt-3">
                <app-comments
                    [commentableContentId]="element.id"
                    [comments]="element.commentsPreview"
                    [totalCommentsNumber]="element.commentsAmount"
                    [commentableContentService]="pollService"
                ></app-comments>
            </div>
        </div>

    </div>


    <div *ngIf="(discussion$ | async)?.length === 0" style="height:90vh" class="d-flex align-items-center justify-content-center">
        <h3 class="text-secondary text-center">დისკუსია არ დაწყებულა</h3>
    </div>

    <div *ngIf="discussionLoading" style="height:90vh" class="d-flex align-items-center justify-content-center">
        <span class="spinner-border spinner-border text-primary" style="width: 100px; height: 100px;" role="status"></span>
    </div>
</div>